 * for /linux/init/main.c
 * in the kernal_init function
 * after the call to do_sysctl_args();
 */

printk("------------------------------------------------------------------\n");
printk("BEGIN LKP-ENC TEST\n");
printk("------------------------------------------------------------------\n");

// Map the area of physical memory corresponding to the device's registers
// (starting 0xfebf1000, size 4KB) somewhere in virtual memory at address
// devmem. Notice that the physical memory where the device's registers are
// present may be different on your computer, use lspci -v in the VM to
// find it
devmem = ioremap(0xfebf2000, 4096);
strdata_lkpenc = "Hello, this is a test string for LKP-ENC";

str_data_ptr = (unsigned long)strdata_lkpenc;

if(devmem) {
    iowrite32(str_data_ptr, devmem+4);
    strdata = ioread32(devmem);
    printk("New string was: %s", (char *) &strdata);
} else {
    printk("ERROR: cannot map device registers\n");
}

printk("------------------------------------------------------------------\n");
printk("END LKP-ENC TEST\n");
printk("------------------------------------------------------------------\n");
