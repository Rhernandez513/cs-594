 * for /linux/init/main.c
 * in the kernal_init function
 * after the call to do_sysctl_args();
 */

printk("------------------------------------------------------------------\n");
printk("BEGIN LKP-ENC TEST\n");
printk("------------------------------------------------------------------\n");

// Map the area of physical memory corresponding to the device's registers
// (starting 0xfebf1000, size 4KB) somewhere in virtual memory at address
// devmem. Notice that the physical memory where the device's registers are
// present may be different on your computer, use lspci -v in the VM to
// find it
devmem = ioremap(0xfebf2000, 4096);
strdata_lkpenc = "Hello, this is a test string for LKP-ENC";

printk("strdata_lkpenc: %s\n", strdata_lkpenc);

str_data_ptr = (unsigned long)strdata_lkpenc;

printk("str_data_ptr before calling io string was: %s\n", (char *) str_data_ptr);

if(devmem) {
    printk("calling iowrite, str_data_ptr as unsigned long: %lu\n", str_data_ptr);
    iowrite32(str_data_ptr, devmem+4);
    printk("calling ioread32 and attempting to store what should be an unsigned int in an unsigned long\n");
    str_data_ptr = ioread32(devmem);
    printk("str_data_ptr as unsigned long after calling io string was: %lu\n", str_data_ptr);
    printk("New string was: %s\n", (char *) str_data_ptr);
} else {
    printk("ERROR: cannot map device registers\n");
}

printk("------------------------------------------------------------------\n");
printk("END LKP-ENC TEST\n");
printk("------------------------------------------------------------------\n");
